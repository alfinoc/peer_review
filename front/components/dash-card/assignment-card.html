<link rel="import" href="/components/standard/core-icon/core-icon.html">
<link rel="import" href="/components/standard/core-icons/editor-icons.html">
<link rel="import" href="/components/standard/paper-fab/paper-fab.html">
<link rel="import" href="/components/standard/core-collapse/core-collapse.html">
<link rel="import" href="/components/standard/paper-radio-group/paper-radio-group.html">
<link rel="import" href="/components/standard/paper-button/paper-button.html">
<link rel="import" href="/components/standard/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/components/standard/paper-dialog/paper-action-dialog.html">
<link rel="import" href="/components/standard/paper-dialog/paper-dialog.html">
<link rel="import" href="/components/standard/paper-input/paper-input.html">

<link rel="import" href="/components/forms/editable-text.html">

<polymer-element name="assignment-card">
   <template>
      <link rel="stylesheet" type="text/css" href="dash-card.css">
      <h1 layout horizontal>
         <span flex self-center>Assignments</span>
         <paper-fab self-center class="headerbutton" icon="add" mini on-click="{{ addAssignment }}"></paper-fab>
      </h1>
      <div class="content">
         
         <ul class="toplevel">
            <template repeat="{{ a in assignments }}">
               <li>
                  <div layout horizontal>
                     <paper-icon-button id="edit" class="hide" icon="editor:mode-edit" on-click="{{ editAssignment }}"></paper-icon-button>
                     <div class="clickable" on-click="{{ toggleCollapseSection }}" flex self-center>
                        {{ a.name || 'Untitled' }}
                     </div>
                     <paper-radio-group selected="off" class="dark">
                        <paper-radio-button name="off"></paper-radio-button>
                        <paper-radio-button name="respond"></paper-radio-button>
                        <paper-radio-button name="feedback"></paper-radio-button>
                     </paper-radio-group>
                  </div>
                  <core-collapse>
                     <template if="{{ a.questions && a.questions.length > 0 }}">
                        <ol>
                           <template repeat="{{ q in a.questions }}">
                              <li><editable-text value="{{ q }}"></editable-text></li>
                           </template>
                        </ol>
                     </template>
                  </core-collapse>
                  <paper-action-dialog backdrop>
                     <h1>Edit Assignment</h1>
                     <div layout vertical class="form">
                        <paper-input floatinglabel label="Title" value="{{ a.name }}"></paper-input>
                        <paper-button>Delete</paper-button>
                     <div>
                     <paper-button dismissive>Cancel</paper-button>
                     <paper-button affirmative on-click="{{ saveForm }}">Save</paper-button>
                  </paper-action-dialog>
               </li>
            </template>
         </ul>
   </template>
      <script>

Polymer('assignment-card', {
   publish: {
      'assignments': []
   },

   created: function() {
      this.assignments = [];
   },

   toAssignmentProto: function(keyed, numbered) {
      var proto = {};
      proto['title'] = keyed['title']
      proto['questions'] = JSON.stringify(numbered)
      return proto;
   },

   toggleCollapseSection: function(evt) {
      var ancestor = evt.target.parentElement.parentElement;
      var collapse = ancestor.querySelector('core-collapse');
      var editButton = ancestor.querySelector('#edit');
      collapse.toggle();
      if (collapse.opened)
         editButton.classList.remove('hide');
      else
         editButton.classList.add('hide');
   },

   addAssignment: function() {
      this.$.add.toggle();
   },

   editAssignment: function(evt) {
      var ancestor = evt.target.parentElement.parentElement;
      var editor = ancestor.querySelector('paper-action-dialog');
      editor.toggle();
   },

   saveForm: function(evt) {
      var ancestor = evt.target.parentElement;
      var serialize = this.toAssignmentProto.bind(this);
      ancestor.querySelector('async-form').submit(serialize);
   }
});

   </script>
</polymer-element>